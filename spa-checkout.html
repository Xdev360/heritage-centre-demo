<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout ‚Äî Royal Retreat Spa Booking</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Playfair Display', serif;
      background: var(--neutral-50);
    }
    
    .checkout-container {
      max-width: 900px;
      margin: 0 auto;
      padding: var(--space-8) var(--space-4);
    }
    
    .checkout-card {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--space-8);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      margin-bottom: var(--space-6);
    }
    
    .form-group {
      margin-bottom: var(--space-5);
    }
    
    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: var(--space-2);
      color: var(--neutral-700);
    }
    
    .form-input {
      width: 100%;
      padding: var(--space-4);
      border: 2px solid var(--neutral-300);
      border-radius: var(--radius-lg);
      font-size: 1rem;
      font-family: 'Playfair Display', serif;
      transition: border-color 0.3s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #ec4899;
    }
    
    .datetime-picker {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
    }
    
    .service-summary-item {
      display: flex;
      justify-content: space-between;
      padding: var(--space-3);
      background: var(--neutral-50);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-2);
    }
    
    .total-section {
      border-top: 2px solid var(--neutral-200);
      padding-top: var(--space-4);
      margin-top: var(--space-4);
    }
  </style>
</head>
<body>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <header class="header" id="main-header">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <div class="nav-logo-icon">HC</div>
        <span>Heritage Centre</span>
      </a>
      <nav class="nav-main">
        <a href="index.html" class="nav-link">Home</a>
        <a href="spa-services.html" class="nav-link">Back to Services</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="checkout-container">
      <!-- Progress Steps -->
      <div style="display: flex; justify-content: center; gap: var(--space-6); margin-bottom: var(--space-10);">
        <div style="display: flex; align-items: center; gap: var(--space-2);">
          <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">1</div>
          <span style="font-weight: 600;">Services</span>
        </div>
        <div style="width: 60px; height: 2px; background: var(--neutral-300); align-self: center;"></div>
        <div style="display: flex; align-items: center; gap: var(--space-2);">
          <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">2</div>
          <span style="font-weight: 600; color: #ec4899;">Checkout</span>
        </div>
        <div style="width: 60px; height: 2px; background: var(--neutral-300); align-self: center;"></div>
        <div style="display: flex; align-items: center; gap: var(--space-2);">
          <div style="width: 40px; height: 40px; background: var(--neutral-300); color: var(--neutral-600); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">3</div>
          <span style="font-weight: 600; color: var(--neutral-600);">Payment</span>
        </div>
      </div>

      <h1 style="font-size: 2.5rem; font-weight: 800; text-align: center; margin-bottom: var(--space-8);">Complete Your Booking</h1>

      <div style="display: grid; grid-template-columns: 1fr 400px; gap: var(--space-6);">
        
        <!-- Checkout Form -->
        <div>
          <div class="checkout-card">
            <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: var(--space-6);">üìÖ Select Date & Time</h2>
            
            <div class="datetime-picker">
              <div class="form-group">
                <label class="form-label">Preferred Date</label>
                <input type="date" class="form-input" id="booking-date" required min="">
              </div>
              <div class="form-group">
                <label class="form-label">Preferred Time</label>
                <select class="form-input" id="booking-time" required>
                  <option value="">Select time</option>
                  <option value="09:00">9:00 AM</option>
                  <option value="10:00">10:00 AM</option>
                  <option value="11:00">11:00 AM</option>
                  <option value="12:00">12:00 PM</option>
                  <option value="13:00">1:00 PM</option>
                  <option value="14:00">2:00 PM</option>
                  <option value="15:00">3:00 PM</option>
                  <option value="16:00">4:00 PM</option>
                  <option value="17:00">5:00 PM</option>
                  <option value="18:00">6:00 PM</option>
                </select>
              </div>
            </div>
          </div>

          <div class="checkout-card">
            <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: var(--space-6);">üë§ Your Information</h2>
            
            <div class="form-group">
              <label class="form-label">Full Name *</label>
              <input type="text" class="form-input" id="customer-name" placeholder="Enter your full name" required>
            </div>

            <div class="form-group">
              <label class="form-label">Email Address *</label>
              <input type="email" class="form-input" id="customer-email" placeholder="your.email@example.com" required>
            </div>

            <div class="form-group">
              <label class="form-label">Phone Number *</label>
              <input type="tel" class="form-input" id="customer-phone" placeholder="080XXXXXXXX" required>
            </div>

            <div class="form-group">
              <label class="form-label">Special Requests (Optional)</label>
              <textarea class="form-input" id="special-requests" rows="3" placeholder="Any allergies, preferences, or special requirements..."></textarea>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div>
          <div class="checkout-card" style="position: sticky; top: 100px;">
            <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: var(--space-5);">üìã Booking Summary</h2>
            
            <div id="services-summary" style="margin-bottom: var(--space-5);">
              <!-- Services will be loaded here -->
            </div>

            <div class="total-section">
              <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-3);">
                <span style="font-weight: 600; color: var(--neutral-700);">Total Duration:</span>
                <span id="total-duration" style="font-weight: 700;">0 min</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-5);">
                <span style="font-weight: 800; font-size: 1.125rem;">Total Amount:</span>
                <span id="total-amount" style="font-weight: 800; font-size: 1.75rem; color: #ec4899;">‚Ç¶0</span>
              </div>

              <button id="proceed-payment-btn" class="btn btn-primary btn-lg" style="width: 100%; background: linear-gradient(135deg, #ec4899, #8b5cf6);" onclick="proceedToPayment()">
                Proceed to Payment ‚Üí
              </button>
              
              <a href="spa-services.html" class="btn btn-ghost btn-sm" style="width: 100%; margin-top: var(--space-3); text-align: center; text-decoration: none;">
                ‚Üê Back to Services
              </a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script>
    // Load cart from session
    const cart = JSON.parse(sessionStorage.getItem('spa_checkout_cart') || '[]');

    if (cart.length === 0) {
      alert('Your cart is empty. Redirecting to services...');
      window.location.href = 'spa-services.html';
    }

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('booking-date').setAttribute('min', today);
    document.getElementById('booking-date').value = today;

    // Display services summary
    function displaySummary() {
      const summaryEl = document.getElementById('services-summary');
      let totalPrice = 0;
      let totalDuration = 0;

      let html = '';
      cart.forEach(item => {
        totalPrice += item.price;
        totalDuration += item.duration;
        
        html += `
          <div class="service-summary-item">
            <div>
              <div style="font-weight: 600; margin-bottom: 4px;">${item.name}</div>
              <div style="font-size: 0.875rem; color: var(--neutral-600);">${item.duration} minutes</div>
            </div>
            <div style="font-weight: 700; color: #10B981;">‚Ç¶${item.price.toLocaleString()}</div>
          </div>
        `;
      });

      summaryEl.innerHTML = html;
      document.getElementById('total-duration').textContent = totalDuration + ' min';
      document.getElementById('total-amount').textContent = '‚Ç¶' + totalPrice.toLocaleString();
    }

    // Proceed to payment
    function proceedToPayment() {
      const name = document.getElementById('customer-name').value.trim();
      const email = document.getElementById('customer-email').value.trim();
      const phone = document.getElementById('customer-phone').value.trim();
      const date = document.getElementById('booking-date').value;
      const time = document.getElementById('booking-time').value;
      const specialRequests = document.getElementById('special-requests').value.trim();

      if (!name || !email || !phone || !date || !time) {
        alert('Please fill in all required fields');
        return;
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert('Please enter a valid email address');
        return;
      }

      // Calculate totals
      const totalPrice = cart.reduce((sum, item) => sum + item.price, 0);
      const totalDuration = cart.reduce((sum, item) => sum + item.duration, 0);

      // Generate booking ID
      const bookingId = 'SPA-' + Date.now();

      // Create booking object
      const booking = {
        bookingId: bookingId,
        type: 'spa_booking',
        services: cart,
        servicesSummary: cart.map(s => s.name).join(', '),
        customerName: name,
        customerEmail: email,
        customerPhone: phone,
        bookingDate: date,
        bookingTime: time,
        specialRequests: specialRequests,
        totalAmount: totalPrice,
        totalDuration: totalDuration,
        timestamp: new Date().toISOString(),
        status: 'pending'
      };

      // Save to spa bookings
      let bookings = JSON.parse(localStorage.getItem('hc_spa_bookings') || '[]');
      bookings.push(booking);
      localStorage.setItem('hc_spa_bookings', JSON.stringify(bookings));

      // Save current booking for payment page
      localStorage.setItem('current_booking', JSON.stringify(booking));

      // Clear cart
      localStorage.removeItem('hc_spa_cart');
      sessionStorage.removeItem('spa_checkout_cart');

      // Redirect to payment confirmation
      const dateTime = new Date(date + ' ' + time).toLocaleString();
      window.location.href = `payment-confirmation.html?bookingId=${bookingId}&amount=${totalPrice}&service=${encodeURIComponent('Spa Services - ' + cart.length + ' treatments')}&datetime=${encodeURIComponent(dateTime)}`;
    }

    // Initialize
    displaySummary();
  </script>
</body>
</html>
