<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment Confirmation ‚Äî Heritage Centre</title>
  <meta name="description" content="Complete your payment by transferring to our bank account" />
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .countdown-timer {
      font-size: 3rem;
      font-weight: 800;
      color: var(--primary-600);
      text-align: center;
      margin: var(--space-6) 0;
      font-variant-numeric: tabular-nums;
    }
    .countdown-timer.urgent {
      color: var(--error-600);
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .bank-details-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: var(--space-8);
      border-radius: var(--radius-xl);
      margin: var(--space-6) 0;
    }
    .bank-detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4) 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    .bank-detail-row:last-child {
      border-bottom: none;
    }
    .bank-detail-label {
      font-size: 0.875rem;
      opacity: 0.9;
      font-weight: 500;
    }
    .bank-detail-value {
      font-size: 1.125rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    .copy-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: var(--space-1) var(--space-3);
      border-radius: var(--radius-md);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .copy-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .copy-btn.copied {
      background: rgba(34, 197, 94, 0.3);
      border-color: rgba(34, 197, 94, 0.5);
    }
    .instruction-step {
      display: flex;
      gap: var(--space-4);
      margin-bottom: var(--space-5);
    }
    .instruction-number {
      width: 32px;
      height: 32px;
      background: var(--primary-500);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }
    .transaction-summary {
      background: var(--neutral-50);
      border: 1px solid var(--neutral-200);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      margin-bottom: var(--space-6);
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: var(--space-3) 0;
      border-bottom: 1px solid var(--neutral-200);
    }
    .summary-row:last-child {
      border-bottom: none;
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--primary-600);
      padding-top: var(--space-4);
    }
  </style>
</head>
<body data-page="payment">
  <!-- Navigation -->
  <header class="header" id="main-header">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <div class="nav-logo-icon">HC</div>
        <span>Heritage Centre</span>
      </a>
      <nav class="nav-main">
        <a href="index.html" class="nav-link">Home</a>
        <a href="about.html" class="nav-link">About Us</a>
        <a href="cinema-booking.html" class="nav-link">Cinema</a>
        <a href="contact.html" class="nav-link">Contact</a>
      </nav>
      <div class="nav-actions">
        <a href="account.html" class="btn btn-ghost btn-sm" id="signin-btn">Sign In</a>
        <a href="account.html" class="btn btn-primary btn-sm" id="create-btn">Get Started</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <div class="container" style="padding: var(--space-8) var(--space-4); max-width: 800px;">
      <!-- Breadcrumbs -->
      <nav class="breadcrumbs" style="margin-bottom: var(--space-6);">
        <a href="index.html" class="breadcrumb-item">Home</a>
        <span class="breadcrumb-separator">/</span>
        <a href="bookings.html" class="breadcrumb-item">Bookings</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-item active">Payment Confirmation</span>
      </nav>

      <!-- Header -->
      <div style="text-align: center; margin-bottom: var(--space-8);">
        <div style="width: 80px; height: 80px; margin: 0 auto var(--space-4); background: var(--primary-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">
          üè¶
        </div>
        <h1 style="font-size: 2rem; margin-bottom: var(--space-3);">Complete Your Payment</h1>
        <p style="color: var(--neutral-600); font-size: 1.125rem;">
          Transfer the exact amount to our bank account below
        </p>
      </div>

      <!-- Countdown Timer -->
      <div class="card" style="text-align: center; margin-bottom: var(--space-6);">
        <p style="font-size: 0.875rem; color: var(--neutral-600); margin-bottom: var(--space-2);">
          Time remaining to complete payment:
        </p>
        <div class="countdown-timer" id="countdown-timer">05:00</div>
        <p style="font-size: 0.875rem; color: var(--neutral-500);" id="timer-message">
          Payment window expires at <strong id="expiry-time"></strong>
        </p>
      </div>

      <!-- Transaction Summary -->
      <div class="transaction-summary" id="transaction-summary">
        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-4);">Transaction Summary</h3>
        <div class="summary-row">
          <span>Booking Reference:</span>
          <strong id="booking-ref">‚Äî</strong>
        </div>
        <div class="summary-row">
          <span>Service Type:</span>
          <strong id="service-type">‚Äî</strong>
        </div>
        <div class="summary-row">
          <span>Date & Time:</span>
          <strong id="booking-datetime">‚Äî</strong>
        </div>
        <div class="summary-row">
          <span>Total Amount:</span>
          <strong id="total-amount">‚Ç¶0.00</strong>
        </div>
      </div>

      <!-- Bank Details Card -->
      <div class="bank-details-card">
        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: var(--space-5); text-align: center;">
          Bank Transfer Details
        </h3>
        
        <div class="bank-detail-row">
          <span class="bank-detail-label">Bank Name</span>
          <span class="bank-detail-value">
            <span id="bank-name">First Bank of Nigeria</span>
            <button class="copy-btn" onclick="copyToClipboard('bank-name', this)">Copy</button>
          </span>
        </div>

        <div class="bank-detail-row">
          <span class="bank-detail-label">Account Number</span>
          <span class="bank-detail-value">
            <span id="account-number">3012345678</span>
            <button class="copy-btn" onclick="copyToClipboard('account-number', this)">Copy</button>
          </span>
        </div>

        <div class="bank-detail-row">
          <span class="bank-detail-label">Account Name</span>
          <span class="bank-detail-value">
            <span id="account-name">Heritage Centre Limited</span>
            <button class="copy-btn" onclick="copyToClipboard('account-name', this)">Copy</button>
          </span>
        </div>

        <div class="bank-detail-row">
          <span class="bank-detail-label">Amount to Transfer</span>
          <span class="bank-detail-value" style="font-size: 1.5rem;">
            <span id="transfer-amount">‚Ç¶0.00</span>
            <button class="copy-btn" onclick="copyToClipboard('transfer-amount', this)">Copy</button>
          </span>
        </div>

        <div style="margin-top: var(--space-6); padding: var(--space-4); background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(255, 255, 255, 0.2);">
          <p style="font-size: 0.875rem; margin: 0;">
            ‚ö†Ô∏è <strong>Important:</strong> Please transfer the EXACT amount shown above. Include your booking reference <strong id="ref-reminder">‚Äî</strong> in the transfer narration/description.
          </p>
        </div>
      </div>

      <!-- Instructions -->
      <div class="card" style="margin-bottom: var(--space-6);">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: var(--space-5);">How to Complete Payment</h3>
        
        <div class="instruction-step">
          <div class="instruction-number">1</div>
          <div>
            <h4 style="font-weight: 600; margin-bottom: var(--space-2);">Open Your Bank App</h4>
            <p style="color: var(--neutral-600); font-size: 0.938rem;">
              Use your mobile banking app or internet banking platform to initiate a transfer.
            </p>
          </div>
        </div>

        <div class="instruction-step">
          <div class="instruction-number">2</div>
          <div>
            <h4 style="font-weight: 600; margin-bottom: var(--space-2);">Enter Bank Details</h4>
            <p style="color: var(--neutral-600); font-size: 0.938rem;">
              Copy and paste the bank account number and name shown above. Use the copy buttons for accuracy.
            </p>
          </div>
        </div>

        <div class="instruction-step">
          <div class="instruction-number">3</div>
          <div>
            <h4 style="font-weight: 600; margin-bottom: var(--space-2);">Transfer Exact Amount</h4>
            <p style="color: var(--neutral-600); font-size: 0.938rem;">
              Enter the exact amount displayed. Include your booking reference in the transfer description/narration.
            </p>
          </div>
        </div>

        <div class="instruction-step">
          <div class="instruction-number">4</div>
          <div>
            <h4 style="font-weight: 600; margin-bottom: var(--space-2);">Confirm Transfer</h4>
            <p style="color: var(--neutral-600); font-size: 0.938rem;">
              After successfully completing the transfer in your bank app, click the "Payment Sent" button below.
            </p>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; gap: var(--space-4); flex-wrap: wrap;">
        <button 
          class="btn btn-primary btn-lg" 
          id="payment-sent-btn"
          style="flex: 1; min-width: 200px;"
          onclick="confirmPaymentSent()"
        >
          ‚úì Payment Sent ‚Äî Confirm Transfer
        </button>
        <a 
          href="bookings.html" 
          class="btn btn-ghost btn-lg" 
          style="flex: 1; min-width: 200px;"
        >
          Cancel & Return
        </a>
      </div>

      <!-- Warning Notice -->
      <div style="margin-top: var(--space-6); padding: var(--space-4); background: var(--warning-50); border: 1px solid var(--warning-200); border-radius: var(--radius-lg);">
        <p style="font-size: 0.875rem; color: var(--warning-800); margin: 0;">
          <strong>‚è±Ô∏è Note:</strong> If the timer expires before you confirm payment, you'll need to restart the booking process. Your payment will be verified manually by our admin team within 24 hours. You'll receive confirmation via email/SMS once approved.
        </p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer style="background: white; border-top: 1px solid var(--neutral-200); padding: var(--space-8) var(--space-4); margin-top: var(--space-12);">
    <div class="container" style="text-align: center;">
      <p style="color: var(--neutral-500); font-size: 0.875rem;">
        ¬© 2024 Heritage Centre. All rights reserved. | Secure peer-to-peer payment system
      </p>
    </div>
  </footer>

  <script src="js/nav.js"></script>
  <script>
    // Payment confirmation logic
    let countdownInterval;
    let timeRemaining = 300; // 5 minutes in seconds
    let paymentData = {};

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      loadPaymentData();
      displayTransactionSummary();
      startCountdown();
    });

    // Load payment data from URL params or localStorage
    function loadPaymentData() {
      const urlParams = new URLSearchParams(window.location.search);
      const bookingId = urlParams.get('bookingId') || generateBookingRef();
      
      // Try to load from pending payment
      const pendingPayment = localStorage.getItem(`hc_pending_payment_${bookingId}`);
      
      if (pendingPayment) {
        paymentData = JSON.parse(pendingPayment);
      } else {
        // Create new payment data
        paymentData = {
          bookingId: bookingId,
          amount: parseFloat(urlParams.get('amount')) || 0,
          serviceType: urlParams.get('service') || 'Cinema Booking',
          datetime: urlParams.get('datetime') || new Date().toISOString(),
          status: 'awaiting_transfer',
          createdAt: new Date().toISOString(),
          expiresAt: new Date(Date.now() + 5 * 60 * 1000).toISOString()
        };
        
        // Save to localStorage
        localStorage.setItem(`hc_pending_payment_${bookingId}`, JSON.stringify(paymentData));
      }
    }

    // Display transaction summary
    function displayTransactionSummary() {
      document.getElementById('booking-ref').textContent = paymentData.bookingId;
      document.getElementById('ref-reminder').textContent = paymentData.bookingId;
      document.getElementById('service-type').textContent = paymentData.serviceType;
      document.getElementById('booking-datetime').textContent = formatDateTime(paymentData.datetime);
      document.getElementById('total-amount').textContent = formatCurrency(paymentData.amount);
      document.getElementById('transfer-amount').textContent = formatCurrency(paymentData.amount);
      
      const expiryTime = new Date(paymentData.expiresAt);
      document.getElementById('expiry-time').textContent = expiryTime.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Start countdown timer
    function startCountdown() {
      const expiresAt = new Date(paymentData.expiresAt);
      const timerEl = document.getElementById('countdown-timer');
      const messageEl = document.getElementById('timer-message');
      
      countdownInterval = setInterval(() => {
        const now = new Date();
        timeRemaining = Math.floor((expiresAt - now) / 1000);
        
        if (timeRemaining <= 0) {
          clearInterval(countdownInterval);
          timerEl.textContent = '00:00';
          timerEl.classList.add('urgent');
          messageEl.innerHTML = '<strong style="color: var(--error-600);">‚è∞ Payment window expired. Please restart your booking.</strong>';
          document.getElementById('payment-sent-btn').disabled = true;
          document.getElementById('payment-sent-btn').style.opacity = '0.5';
          return;
        }
        
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        
        // Add urgent styling when under 1 minute
        if (timeRemaining <= 60) {
          timerEl.classList.add('urgent');
        }
      }, 1000);
    }

    // Copy to clipboard function
    function copyToClipboard(elementId, button) {
      const element = document.getElementById(elementId);
      const text = element.textContent.trim();
      
      navigator.clipboard.writeText(text).then(() => {
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(() => {
          button.textContent = 'Copy';
          button.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy. Please copy manually.');
      });
    }

    // Confirm payment sent
    function confirmPaymentSent() {
      if (timeRemaining <= 0) {
        alert('Payment window has expired. Please restart your booking.');
        return;
      }

      const confirmed = confirm(
        `Have you successfully transferred ${formatCurrency(paymentData.amount)} to the bank account shown above?\n\n` +
        `By clicking OK, you confirm that:\n` +
        `‚úì You've made the transfer from your bank app\n` +
        `‚úì The transfer amount is exactly ${formatCurrency(paymentData.amount)}\n` +
        `‚úì You've included your booking reference (${paymentData.bookingId}) in the transfer description\n\n` +
        `Your payment will be verified by our admin team within 24 hours.`
      );

      if (!confirmed) return;

      // Update payment status to pending
      paymentData.status = 'pending';
      paymentData.confirmedAt = new Date().toISOString();
      
      // Save updated payment data
      localStorage.setItem(`hc_pending_payment_${paymentData.bookingId}`, JSON.stringify(paymentData));
      
      // Add to pending payments list for admin
      addToPendingPaymentsList(paymentData);
      
      // Clear countdown
      clearInterval(countdownInterval);
      
      // Redirect to status page
      window.location.href = `payment-status.html?bookingId=${paymentData.bookingId}`;
    }

    // Add to pending payments list
    function addToPendingPaymentsList(payment) {
      let pendingList = JSON.parse(localStorage.getItem('hc_all_pending_payments') || '[]');
      
      // Check if already exists
      const existingIndex = pendingList.findIndex(p => p.bookingId === payment.bookingId);
      
      if (existingIndex >= 0) {
        pendingList[existingIndex] = payment;
      } else {
        pendingList.push(payment);
      }
      
      localStorage.setItem('hc_all_pending_payments', JSON.stringify(pendingList));
    }

    // Generate booking reference
    function generateBookingRef() {
      const prefix = 'HC';
      const timestamp = Date.now().toString().slice(-8);
      const random = Math.random().toString(36).substring(2, 6).toUpperCase();
      return `${prefix}${timestamp}${random}`;
    }

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-NG', {
        style: 'currency',
        currency: 'NGN',
        minimumFractionDigits: 2
      }).format(amount);
    }

    // Format date/time
    function formatDateTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleDateString('en-NG', {
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      clearInterval(countdownInterval);
    });
  </script>
</body>
</html>
